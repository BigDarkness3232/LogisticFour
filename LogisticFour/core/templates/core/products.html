{% extends "core/base.html" %}
{% block title %}Productos â€” Logistic{% endblock %}
{% block content %}

<h1 class="h1">Productos</h1>

<div class="toolbar">
  <form method="get" style="display:flex; gap:10px; align-items:center">
    <input class="search" type="search" name="q" value="{{ q }}" placeholder="Buscar por SKU, nombre, marca, categorÃ­aâ€¦">
    <button class="btn ghost" type="submit">ðŸ”Ž Buscar</button>
  </form>
  <a href="{% url 'product_add' %}" class="btn">+ Agregar producto</a>
</div>

<div class="table scroll">
  <div class="tr th">
    <div>Nombre del producto</div>
    <div>Estado</div>
    <div>Stock</div>
    <div>CategorÃ­a</div>
    <div>UbicaciÃ³n</div>
  </div>

  {% for p in productos %}
  {% with st=p.stock_total|default:0 %}
  <div class="tr">
    <div>{{ p.nombre }}</div>

    <div>
      {% if st|floatformat:2 == "0.00" %}
        <span class="badge warn">Sin stock</span>
      {% else %}
        {% if p.activo %}
          <span class="badge ok">Activo</span>
        {% else %}
          <span class="badge">Inactivo</span>
        {% endif %}
      {% endif %}
    </div>

    <div>
      {% if st %}
        {{ st|floatformat:0 }} en stock
      {% else %}
        0 en stock
      {% endif %}
    </div>

    <div>{{ p.categoria|default:"â€”" }}</div>

    <div>
      {% if p.bodegas_con_stock %}
        {{ p.bodegas_con_stock }} bodegas
      {% else %}
        0 bodegas
      {% endif %}
    </div>
  </div>
  {% endwith %}
  {% empty %}
  <div class="tr">
    <div class="col-span-2" style="grid-column:1 / -1; padding:12px; color:var(--muted)">
      No hay productos.
    </div>
  </div>
  {% endfor %}
</div>

{% if is_paginated %}
  <div style="display:flex; gap:8px; align-items:center; margin-top:10px">
    {% if page_obj.has_previous %}
      <a class="btn ghost" href="?q={{ q }}&page={{ page_obj.previous_page_number }}">Â« Anterior</a>
    {% else %}
      <span class="btn ghost" style="opacity:.5;pointer-events:none">Â« Anterior</span>
    {% endif %}

    <span>PÃ¡gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
      <a class="btn ghost" href="?q={{ q }}&page={{ page_obj.next_page_number }}">Siguiente Â»</a>
    {% else %}
      <span class="btn ghost" style="opacity:.5;pointer-events:none">Siguiente Â»</span>
    {% endif %}
  </div>
{% endif %}

{% endblock %}