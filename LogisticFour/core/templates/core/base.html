{% load static %} 
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>{% block title %}Logistic ‚Äî Demo{% endblock %}</title>

  <style>
  :root{
    --bg:#f4f5f8; --panel:#ffffff; --ink:#1e1f24; --muted:#7a7f87; --line:#e5e7eb;
    --ok:#16a34a; --warn:#c2410c; --sidebar-w:240px;
    --brand:#E30613;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}

  /* ===== Layout base ===== */
  .sidenav{
    position:fixed; inset:0 auto 0 0; width:var(--sidebar-w);
    background:#222; color:#f1f1f1; display:flex; flex-direction:column; gap:8px;
    padding:14px 12px; border-right:4px solid #111;
    transition:transform .25s ease;
  }
  .sidenav .brand{font-weight:800;letter-spacing:.06em;margin:4px 8px 6px}
  .sidenav nav{display:flex;flex-direction:column;gap:6px;margin-top:10px}

  .sidenav .item,
  .sidenav .subitem{
    color:#ddd;text-decoration:none;padding:10px 12px;border-radius:10px;display:flex;gap:10px;align-items:center
  }
  .sidenav .item:hover{background:#2b2b2b}
  .sidenav .subitem{padding:8px 12px;border-radius:8px}
  .sidenav .subitem:hover{background:#2b2b2b}
  .sidenav .subitem.active{background:rgba(227,6,19,.12); color:#fff; border:1px solid rgba(227,6,19,.35)}

  /* Grupo con t√≠tulo + subnav */
  .nav-group{display:flex;flex-direction:column;gap:6px;padding:6px 0}
  .group-head{
    display:flex;align-items:center;gap:8px;justify-content:space-between;
    padding:10px 12px;border-radius:10px;cursor:pointer;background:transparent;border:0;color:#ddd;width:100%;
  }
  .group-head:hover{background:#2b2b2b}
  .group-head .label{display:flex;gap:8px;align-items:center;font-weight:600}
  .caret{transition:transform .2s ease; font-size:12px; opacity:.85}
  .nav-group.expanded .caret{transform:rotate(90deg)}
  .subnav{display:none;flex-direction:column;padding-left:8px;margin-top:6px}
  .nav-group.expanded .subnav{display:flex}

  .sidenav .sidenav-footer{margin-top:auto;display:flex;flex-direction:column;gap:6px}

  .main{margin-left:var(--sidebar-w);min-height:100vh;display:flex;flex-direction:column}
  .topbar{
    display:flex;align-items:center;gap:10px;justify-content:space-between;
    padding:12px 18px;background:#fff;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:500
  }
  .menu-toggle{
    display:none; /* visible en m√≥viles */
    border:1px solid var(--line); background:#fff; border-radius:10px; padding:8px 10px; font-size:18px; line-height:1; cursor:pointer;
  }
  .search{flex:1;max-width:460px;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fafafa}
  .icons{display:flex;align-items:center;gap:10px}
  .icons .dot{width:28px;height:28px;border-radius:50%;background:#e6e7ee;border:1px solid var(--line)}
  .icons .avatar{display:inline-grid;place-items:center;width:32px;height:32px;border:1px solid var(--line);border-radius:50%;background:#fff}

  .content{padding:18px;display:grid;gap:16px}
  .h1{margin:6px 0 8px}

  /* ===== Cards & grids ===== */
  .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:14px}
  .card-title{font-weight:700;margin-bottom:10px}
  .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .kpi{background:#fff;border:1px solid var(--line);border-radius:12px;padding:18px;text-align:center}
  .kpi .num{font-size:26px;font-weight:800}
  .kpi .lbl{color:var(--muted);font-size:12px;margin-top:4px}

  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}

  /* ===== Bars (gr√°fico fake) ===== */
  .bars{display:flex;gap:22px;align-items:flex-end;height:160px;padding:8px}
  .bar{display:grid;gap:6px;justify-items:center}
  .bar span{display:block;width:28px;background:#111;border:2px solid #000;border-radius:4px}
  .bar label{font-size:12px;color:#555}

  /* ===== Table ===== */
  .table{display:grid;border:1px solid var(--line);border-radius:10px;overflow:hidden}
  .table.scroll{max-height:460px;overflow:auto}
  .tr{display:grid;grid-template-columns:2fr 1fr 1fr 1fr 1fr;border-bottom:1px solid var(--line);background:#fff}
  .tr:last-child{border-bottom:0}
  .tr > div{padding:12px}
  .tr.th{background:#eef0f6;font-weight:700}
  .badge{padding:3px 8px;border-radius:999px;font-size:12px;border:1px solid var(--line);background:#f8fafc}
  .badge.ok{background:#e8f7ee;color:#065f46;border-color:#bfe7cb}
  .badge.warn{background:#fff1e8;color:#8a2c0d;border-color:#f3d3bf}

  /* ===== Buttons ===== */
  .toolbar{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}
  .btn{background:#111;color:#fff;border:0;border-radius:8px;padding:10px 14px;text-decoration:none;display:inline-flex;align-items:center;gap:6px}
  .btn:hover{opacity:.9}
  .btn.ghost{background:#fff;color:#111;border:1px solid var(--line)}
  .btn.big{padding:14px 18px;font-weight:700}

  /* ===== Form ===== */
  .form{display:grid;gap:12px;background:#fff;border:1px solid var(--line);border-radius:12px;padding:14px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .field{display:grid;gap:6px}
  .field label{font-size:12px;color:#6b7280}
  .field input,.field select,.field textarea{padding:10px 12px;border:1px solid var(--line);border-radius:8px;background:#fafafa}
  .col-span-2{grid-column:1 / -1}

  /* ===== Backdrop para m√≥vil ===== */
  .backdrop{
    position:fixed; inset:0; background:rgba(0,0,0,.35); backdrop-filter:saturate(0.9);
    opacity:0; pointer-events:none; transition:opacity .2s ease; z-index:900;
  }
  .backdrop.show{opacity:1; pointer-events:auto;}

  /* ===== Responsive ===== */
  @media (max-width: 1024px){
    .menu-toggle{display:inline-flex;align-items:center;justify-content:center}
    .main{margin-left:0}
    .sidenav{transform:translateX(-100%); z-index:1000}
    .sidenav.open{transform:translateX(0)}
    .kpis{grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
    .grid-2{grid-template-columns:1fr}
    .table{overflow:auto}
    .tr{min-width:700px}
  }
  @media (max-width: 480px){
    .search{max-width:100%}
    .kpi .num{font-size:22px}
    .topbar{padding:10px 12px}
    .content{padding:14px}
  }
  </style>
</head>
<body>
  <!-- Iconos (sprite) -->
  <svg width="0" height="0" style="position:absolute;visibility:hidden">
    <defs>
      <symbol id="icon-warehouse" viewBox="0 0 24 24">
        <path d="M3 10V8l9-5 9 5v2h-2v9a1 1 0 0 1-1 1h-4v-7H10v7H6a1 1 0 0 1-1-1v-9H3zM11 20v-5h2v5h-2zM5 10v8h3v-8H5zm11 0v8h3v-8h-3z"/>
      </symbol>
    </defs>
  </svg>

  <!-- Backdrop -->
  <div class="backdrop" id="backdrop"></div>

  <!-- Sidebar -->
  <aside class="sidenav" id="sidenav" aria-label="Navegaci√≥n lateral">
    <div class="brand">LogisticFour</div>
    <nav>
      {% if user.is_authenticated %}
        <a href="{% url 'dashboard' %}" class="item">üè† Inicio</a>
        <a href="{% url 'products' %}" class="item">üì¶ Productos</a>
        <a href="#" class="item">üè∑Ô∏è Categor√≠as</a>

        <!-- ===== Grupo: Sucursales / Bodegas (colapsable) ===== -->
        <div class="nav-group {% if request.resolver_match and request.resolver_match.url_name in 'sucursal-list bodega-list' %}expanded{% endif %}" data-group>
          <button class="group-head" type="button" aria-expanded="{% if request.resolver_match and request.resolver_match.url_name in 'sucursal-list bodega-list' %}true{% else %}false{% endif %}">
            <span class="label">
              <svg width="16" height="16" aria-hidden="true"><use xlink:href="#icon-warehouse"></use></svg>
              Sucursales / Bodegas
            </span>
            <span class="caret">‚ñ∂</span>
          </button>
          <div class="subnav" role="group" aria-label="Submen√∫ Sucursales y Bodegas">
            <a href="{% url 'sucursal-list' %}" class="subitem {% if request.resolver_match and request.resolver_match.url_name == 'sucursal-list' %}active{% endif %}">Sucursales</a>
            <a href="{% url 'bodega-list' %}" class="subitem {% if request.resolver_match and request.resolver_match.url_name == 'bodega-list' %}active{% endif %}">Bodegas</a>
          </div>
        </div>
        <!-- ===== Fin Grupo ===== -->

        <a href="#" class="item">üí≥ Finanzas</a>
        <a href="{% url 'product_add' %}" class="item">‚ûï Agregar producto</a>






      {% else %}
        <a href="{% url 'login' %}" class="item">üîê Iniciar sesi√≥n</a>
        <a href="{% url 'test_scanner' %}" class="item">‚ûï test scanner</a>

      {% endif %}

      {% if user.is_authenticated and user.perfil and user.perfil.rol == 'ADMIN' %}
        <a href="{% url 'usuario-list' %}" class="item">üë• Usuarios</a>
      {% endif %}
    </nav>

    <div class="sidenav-footer">
      {% if user.is_authenticated %}
        <a href="#" class="subitem">‚öôÔ∏è Configuraci√≥n</a>
        <a href="{% url 'logout' %}" class="subitem">‚Ü©Ô∏é Cerrar sesi√≥n</a>
      {% endif %}
    </div>
  </aside>

  <main class="main">
    <header class="topbar">
      <button class="menu-toggle" id="menuBtn" aria-label="Abrir men√∫" aria-controls="sidenav" aria-expanded="false">‚ò∞</button>
      <input class="search" placeholder="Buscar‚Ä¶" />
      {% if user.is_authenticated %}
        <div class="icons"><span class="dot" title="Notificaciones"></span><span class="dot" title="Mensajes"></span><span class="avatar" title="Perfil">üë§</span></div>
      {% endif %}
    </header>

    <section class="content">
      {% block content %}{% endblock %}
    </section>
  </main>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'core/js/barcode_scanner.js' %}"></script>


  <script>
  (function(){
    const btn = document.getElementById('menuBtn');
    const sidenav = document.getElementById('sidenav');
    const backdrop = document.getElementById('backdrop');

    function openNav(){
      sidenav.classList.add('open');
      backdrop.classList.add('show');
      btn.setAttribute('aria-expanded','true');
    }
    function closeNav(){
      sidenav.classList.remove('open');
      backdrop.classList.remove('show');
      btn.setAttribute('aria-expanded','false');
    }

    btn.addEventListener('click', () => {
      if (sidenav.classList.contains('open')) closeNav(); else openNav();
    });
    backdrop.addEventListener('click', closeNav);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeNav(); });

    // Cerrar al navegar (m√≥vil)
    sidenav.addEventListener('click', (e) => {
      const isLink = e.target.closest('a');
      if (isLink && window.matchMedia('(max-width: 1024px)').matches) closeNav();
    });

    // Mantener backdrop limpio al volver a desktop
    const mq = window.matchMedia('(min-width: 1025px)');
    mq.addEventListener('change', (e) => { if (e.matches) closeNav(); });

    // ===== L√≥gica colapsable para grupos =====
    const groups = Array.from(document.querySelectorAll('[data-group]'));
    groups.forEach(group => {
      const head = group.querySelector('.group-head');
      const sub = group.querySelector('.subnav');
      const expanded = group.classList.contains('expanded');
      head.setAttribute('aria-expanded', expanded ? 'true' : 'false');

      if (!expanded) sub.style.display = 'none';
      else sub.style.display = 'flex';

      head.addEventListener('click', () => {
        const isOpen = group.classList.toggle('expanded');
        head.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        sub.style.display = isOpen ? 'flex' : 'none';
      });
    });
  })();
  </script>
</body>
</html>
